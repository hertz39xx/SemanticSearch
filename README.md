# æ–‡å­—åµŒå…¥æœå°‹ç³»çµ± (Text to Embedding Search System)

é€™æ˜¯ä¸€å€‹åŸºæ–¼ OpenAI åµŒå…¥æ¨¡å‹å’Œ FAISS å‘é‡è³‡æ–™åº«çš„æ–‡å­—æœå°‹ç³»çµ±ï¼Œèƒ½å¤ å°‡æ–‡å­—æ–‡ä»¶è½‰æ›ç‚ºå‘é‡åµŒå…¥ä¸¦é€²è¡Œèªç¾©æœå°‹ã€‚

## åŠŸèƒ½ç‰¹è‰²

- ğŸ” **èªç¾©æœå°‹**ï¼šä½¿ç”¨ OpenAI çš„ `text-embedding-3-small` æ¨¡å‹é€²è¡Œèªç¾©æœå°‹
- âš¡ **é«˜æ•ˆæª¢ç´¢**ï¼šåŸºæ–¼ FAISS å‘é‡è³‡æ–™åº«ï¼Œæ”¯æ´å¿«é€Ÿç›¸ä¼¼åº¦æœå°‹
- ğŸ’° **æˆæœ¬è¿½è¹¤**ï¼šå³æ™‚è¨ˆç®— API ä½¿ç”¨æˆæœ¬
- â±ï¸ **æ•ˆèƒ½ç›£æ§**ï¼šè©³ç´°çš„åŸ·è¡Œæ™‚é–“åˆ†æ
- ğŸ“„ **å¤šæ–‡ä»¶æ”¯æ´**ï¼šæ”¯æ´å¤šå€‹æ–‡å­—æ–‡ä»¶çš„ç´¢å¼•å’Œæœå°‹
- ğŸš€ **å¿«å–æ©Ÿåˆ¶**ï¼šå…§å»ºå¿«å–ç³»çµ±æå‡æœå°‹æ•ˆèƒ½

## å°ˆæ¡ˆçµæ§‹

```
txt_to_embedding/
â”œâ”€â”€ embedding.py          # åµŒå…¥ç”Ÿæˆå’Œç´¢å¼•å»ºç«‹
â”œâ”€â”€ search.py             # æœå°‹åŠŸèƒ½å’Œæˆæœ¬è¨ˆç®—
â”œâ”€â”€ main.py               # ä¸»ç¨‹å¼å…¥å£
â”œâ”€â”€ txt_files/            # åŸå§‹æ–‡å­—æ–‡ä»¶è«‹ä»¥txtæ”¾ç½®æ–¼æ­¤
â”œâ”€â”€ embedding_files/      # ç”Ÿæˆçš„indexèˆ‡dataæ”¾é€™
â””â”€â”€ README.md
```

## å®‰è£éœ€æ±‚

### Python å¥—ä»¶

```bash
pip install openai faiss-cpu numpy tiktoken python-dotenv
```

### ç’°å¢ƒè¨­å®š

1. å»ºç«‹ `.env` æª”æ¡ˆä¸¦è¨­å®š OpenAI API Keyï¼š

```env
OPENAI_API_KEY=your_openai_api_key_here
```

## ä½¿ç”¨æ–¹æ³•

### 1. å»ºç«‹æ–‡å­—åµŒå…¥ç´¢å¼•

```python
from embedding import build_faiss_index
from main import load_book_with_pages

# è¼‰å…¥ä¸¦è™•ç†æ–‡å­—æ–‡ä»¶
chunks = load_book_with_pages("txt_files/week1.txt")

# å»ºç«‹ FAISS ç´¢å¼•
build_faiss_index(
    chunks, 
    index_path="embedding_files/week1.txt.index",
    meta_path="embedding_files/week1.txt_meta.json"
)
```

### 2. åŸ·è¡Œæœå°‹

```python
from search import search_faiss_with_cost

# æœå°‹ç›¸ä¼¼å…§å®¹
results = search_faiss_with_cost(
    query="å¤ªç©ºæ—…è¡Œçš„æº–å‚™å·¥ä½œ",
    index_path="embedding_files/week1.txt.index",
    meta_path="embedding_files/week1.txt_meta.json",
    top_k=3
)

print(results)
```

### 3. åŸ·è¡Œä¸»ç¨‹å¼

```bash
python main.py
```

ç¨‹å¼æœƒæç¤ºæ‚¨è¼¸å…¥æŸ¥è©¢å…§å®¹ï¼Œä¸¦é¡¯ç¤ºæœå°‹çµæœã€‚

## æ ¸å¿ƒåŠŸèƒ½èªªæ˜

### æ–‡å­—è™•ç† (`main.py`)

- **`load_book_with_pages()`**ï¼šæ ¹æ“šé ç¢¼æ¨™è¨˜ `[P.æ•¸å­—]` åˆ‡åˆ†æ–‡å­—å…§å®¹
- æ”¯æ´å¤šé æ–‡ä»¶çš„åˆ†æ®µè™•ç†
- å›å‚³åŒ…å«é ç¢¼å’Œæ–‡å­—å…§å®¹çš„å­—å…¸åˆ—è¡¨

### åµŒå…¥ç”Ÿæˆ (`embedding.py`)

- **`embed_texts()`**ï¼šå°‡æ–‡å­—åˆ—è¡¨è½‰æ›ç‚ºå‘é‡åµŒå…¥
- **`build_faiss_index()`**ï¼šå»ºç«‹ FAISS ç´¢å¼•ä¸¦å„²å­˜åˆ°æª”æ¡ˆ
- ä½¿ç”¨ OpenAI çš„ `text-embedding-3-small` æ¨¡å‹

### æœå°‹åŠŸèƒ½ (`search.py`)

- **`search_faiss_with_cost()`**ï¼šåŸ·è¡Œèªç¾©æœå°‹ä¸¦è¨ˆç®—æˆæœ¬
- **`embed_query_with_cost()`**ï¼šå°‡æŸ¥è©¢è½‰æ›ç‚ºåµŒå…¥ä¸¦è¨ˆç®—è²»ç”¨
- **`count_tokens()`**ï¼šè¨ˆç®—æ–‡å­— token æ•¸é‡
- **å¿«å–æ©Ÿåˆ¶**ï¼šé¿å…é‡è¤‡è¼‰å…¥ç´¢å¼•å’Œå…ƒæ•¸æ“š

## æˆæœ¬è¨ˆç®—

ç³»çµ±æœƒå³æ™‚è¨ˆç®— OpenAI API çš„ä½¿ç”¨æˆæœ¬ï¼š

- **æ¨¡å‹**ï¼š`text-embedding-3-small`
- **åƒ¹æ ¼**ï¼š$0.00002 USD per 1K tokens
- **é¡¯ç¤ºè³‡è¨Š**ï¼šToken æ•¸é‡ã€åµŒå…¥æˆæœ¬ã€åŸ·è¡Œæ™‚é–“

## æ•ˆèƒ½å„ªåŒ–

- **å¿«å–æ©Ÿåˆ¶**ï¼šç´¢å¼•å’Œå…ƒæ•¸æ“šè¼‰å…¥å¾Œæœƒå¿«å–åœ¨è¨˜æ†¶é«”ä¸­
- **æ™‚é–“åˆ†æ**ï¼šè©³ç´°è¨˜éŒ„å„éšæ®µåŸ·è¡Œæ™‚é–“
- **æ‰¹æ¬¡è™•ç†**ï¼šæ”¯æ´å¤šå€‹æ–‡å­—çš„æ‰¹æ¬¡åµŒå…¥

## ç¯„ä¾‹è¼¸å‡º

```
Query Tokens: 15
Embedding Cost: $0.00000030 USD
Embedding Time: 0.234s
Index è¼‰å…¥æ™‚é–“: 0.012s
FAISS æœå°‹æ™‚é–“: 0.001s
å…±æ‰¾åˆ° 3 ç­†ç›¸ä¼¼å…§å®¹
æŸ¥è©¢è€—è²»ï¼š$0.00000030 (embedding cost only)
ç¸½è€—æ™‚ï¼š0.25s
æ™‚é–“åˆ†è§£ï¼šIndexè¼‰å…¥(0.012s) + Embedding(0.234s) + æœå°‹(0.001s)
```

## æ³¨æ„äº‹é …

1. **API Key å®‰å…¨**ï¼šè«‹ç¢ºä¿ `.env` æª”æ¡ˆä¸è¦æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»çµ±
2. **æˆæœ¬æ§åˆ¶**ï¼šå»ºè­°è¨­å®š API ä½¿ç”¨é™åˆ¶ä»¥é¿å…æ„å¤–è²»ç”¨
3. **æª”æ¡ˆæ ¼å¼**ï¼šæ–‡å­—æ–‡ä»¶éœ€è¦åŒ…å«é ç¢¼æ¨™è¨˜ `[P.æ•¸å­—]` æ‰èƒ½æ­£ç¢ºåˆ†æ®µ
4. **è¨˜æ†¶é«”ä½¿ç”¨**ï¼šå¤§å‹æ–‡ä»¶å¯èƒ½éœ€è¦è¼ƒå¤šè¨˜æ†¶é«”ä¾†å»ºç«‹ç´¢å¼•
